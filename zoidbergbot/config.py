"""
if you see an insane mess here, it's supposed to be zoidberg. Probably only works correcly in certain fonts,
sublime with Ayu doesn't work, for instance.

▌▙▚▛▞▚▚▘▌▚▝▄▙▜▜▀▀▙▌▜▟▌▚▌▌▌▚▚▚▚▚▚▚▚▚▚▚▘▌▚▀▖▚▝▖▚▝▖▚▝▖▚▝▖▚▝▖▚▝▖
▚▀▄▘▀▖▚▙▞█▛▜▐▐▝▞▞▟▜▐▟▐▚▚▐▐▐▗▚▐▗▚▐▗▚▐▗▚▚▚▚▜▝▞▝▖▌▞▖▌▞▖▚▐▗▚▝▖▚
▚▚▐▞▙█▜▐▚▘▞▖▚▗▚▝▖▛▙▐▟▀▖▌▚▐▝▞▞▐▝▞▞▐▝▞▞▞▐▗▚▐▐▞▐▗▘▞▗▝▖▞▝▖▚▗▚▐▝▖
▟▜▚▜▝▖▚▖▘▙▐▐▝▖▚▚▝▛▞▞▙▚▚▚▚▚▚▚▐▐▐▝▞▞▞▞▖▌▌▌▌▌▚▐▗▘▞▝▞▝▞▝▞▝▖▚▗▘▞
▐▝▞▖▌▌▌▀▌▞▞▙▘▌▚▗▚▛▙▜▟▜▐▝▞▖▌▚▚▚▚▚▚▐▝▖▌▚▐▝▖▌▌▌▌▚▐▝▖▌▞▝▞▝▞▖▚▝▝▖
▞▞▞▞▞▞▞▚▚▚▚▚▚▐▝▖▘▛▌▟▟▝▄▚▚▚▚▚▚▐▗▚▘▌▌▌▌▌▌▌▌▌▚▚▀▖▚▝▖▞▝▞▗▚▗▝▖▌▌▖
▚▚▚▌▙▛▟▙▚▚▚▜▗▘▚▐▝▛▙▐▟▚▚▚▐▗▚▚▐▝▞▖▌▌▞▞▐▝▞▐▝▞▞▖▌▛▖▌▚▝▞▝▖▚▝▞▖▞▗
▛▛▙█▙▛█▞▞▖▌▛▖▌▚▘▚▜▌▚█▗▀▞▐▝▖▌▘▘▘▘▚▚▚▐▐▐▐▐▐▝▖▌▌▌▚▝▖▌▞▐▝▖▌▄▝▖▚▘
▛█▙▙▙▛▙▌▌▌█▚▝▐▗▘▌▙▛▞▙▚▚▞▞▞▞▖▖     ▝▝▐▗▚▐ ▘▀   ▚▚▘▞▝▖▚▝▖▖▚▐▗▘
▛▙▙▙▙▛▙▌▌▜▝▖▀▖▘▌▞▞▙▜▐▚▖▙▘▌▚▘  ▖▜▘▗   ▞▞▘   ▙   ▌▚▝▞▝▖▌▞▝▖▚▗▘
█▙▜▟▚▛▙▌▌█▝▞▞▐▝▖▚▛▞▟▌▛▛▌▌▌▌▙       ▝ ▌▞▖ ▝   ▝▗▝▖▌▞▐▗▝▖▌▚▘▖▘
▙▜▜▟▜▜▙▛▞▟▝▖▞▖▛▟█▜▙▚▛▞▘▌▌▞▞▖▌▖▗ ▘ ▘▗▞▐▐▐▗  ▖▝▗▖▚▘▞▝▖▚▚▝▖▚▝▞▖    __________ _____ _____  ____  ______ _____   _____
▛█▜▟▛█▟▞▞▟▐▝▖▚▌▀▝▀▝▀▞  ▞▞▞▖▌▌▚▚▗▖▖▜▐▐▝▖▌▌▌▄▗▀▌▞▖▚▝▞▝▖▖▌▞▖▚▗    |___  / __ \_   _|  __ \|  _ \|  ____|  __ \ / ____|
▛▙▛▙▛▙▙▌▙▀▝           ▐▝▖▌▚▐▐▝▛▀▚▀▞▖▌▌▌▌▞▞▞▞▚▚▗▘▚▚▝▞▝▖▞▗▝▞▝▖      / / |  | || | | |  | | |_) | |__  | |__) | |  __
▛▛▛▙▛▌▘▘              ▞▞▞▞▞▞▖▙▙▛▞▞▞▐▝▞▐▝▞▖▌▞▚▘▘▘▙▗▚▐▝▞▞▖▌▞▝▖     / /| |  | || | | |  | |  _ <|  __| |  _  /| | |_ |
█▜▛▌▘     ▝▗         ▗▚▚▐▝▞▄████▞▖▌▌▌▌▌▜▝▞▝▌▌▌▌▗▗▐▐▗▚▚▐▝▞▝▌▀    / /_| |__| || |_| |__| | |_) | |____| | \ \| |__| |
▛▌▘     ▄▗▐▀▞▚▀▞▚▀▞▖ ▗▚▚▚▚▜█████▞▞▐▝▙▐▐▝▙▚▚▚▚▐ ▌▚▌▌▚▚▘▌▚▚▚▚▘   /_____\____/_____|_____/|____/|______|_|  \_\\_____|
▘   ▗▖▜▐▝▞▖▌▌▌▌▌▌▌▘  ▘▖▐▗▚▛█▜██▛▖▌▌▌▌▞▖▙▚▘▌▚▚▚▘▌    ▘▌▌▌▚▘▌▘
  ▗▞▚▐▐▝▞▞▞▞▐▝▞▐     ▗▝ ▚▚▝▌▛▞▟▐▐▝▖▌▌▚▚▞▖▌▌▌▌▞▖      ▘▌▞▞▞▞▖
▗▞▚▚▚▚▘▌▌▞▖▌▌▌▀      ▝▗▘▖▚▚▚▐▝▖▌▚▚▜▞▞▞▞▞▞▞▐▝▞▐▐▝       ▝▝▞▐
▞▐▝▖▌▚▚▘▌▚▚▚▐▗        ▚▗▝▗▝▝▟▐▐▐▝▌▜▗▚▐▝▞▐▝▞ ▘▘           ▄▚▘
▐▐▐▐▐▐▗▚▚▚▚▐▐▘        ▝▞▗▖▝▖▗▗▗▗▚▝▗▝▐ ▛  ▝      ▌         ▘▌
▚▘▌▚▘▌▚▚▘▌▞▞         ▖ ▝▗▝▘▄▘▗▗ ▖▝▗▐▖▀          ▌
▞▞▞▞▞▞▞▖▌▌▌▖▝            ▞▗ ▞ ▚▀▀▘▘▖            ▌   ▝  ▖
▐▝▞▐▝▞▐▐▝▞▞ ▖      ▝     ▝▖▝▗▝▗▝▗▘▘             ▘
▚▚▚▚▚▚▚▘▌▘       ▞▜        ▘▖▐ ▝               ▗  ▗▄▖
▞▖▌▚▐▗▚▚▘  ▝   ▄▜▐▝      ▗ ▝                 ▖▘▝   ▗▚▀▚▗▄▖▗
▐▐▐▐▐▐▗▚▘  ▖ ▄▜▝▖▌▘  ▗ ▝                    ▘       ▗▚▚▚▝▞▞▖
▘▘▝▝ ▘▌   ▗ ▘▘▝▝▝▝ ▘                 ▘   ▘     ▘     ▘▌▘▘▘▝
"""

# This software is provided free of charge without a warranty - meaning if you're an idiot and somehow
# blow up your sever, I am not liable or responsible.
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at https://mozilla.org/MPL/2.0/.

import configparser
import logging
import codecs
import os
import csv

from json import loads

log = logging.getLogger(__name__)

CONFIG_FILE = "./data/config.ini"
config = configparser.ConfigParser()
config.read_file(codecs.open(CONFIG_FILE, "r+", "utf-8"))


def read_config(section, value, file="./data/config.ini"):
    config.read_file(codecs.open(file, "r+", "utf-8"))


# Bot section.

if bool(config.get("Bot", "token_env_var")):
    BOT_TOKEN = os.getenv("zoidberg_token")
else:
    BOT_TOKEN = int(config.get("Bot", "bot_token", fallback=None))


BOT_PREFIX = config.get("Bot", "bot_prefix", fallback="!")
SPECIAL_USERS_IDS = [int(id_) for id_ in loads(config.get("Bot", "special_user_ids", fallback="[]"))]
BOT_LANGUAGE = config.get("Bot", "language")

# Conf section:
CHANNEL_ID = config.get("conf", "channel_id")
GUILD_ID: int = config.getint("conf", "guild_id")
LOG_ID:int = config.getint("conf", "log_channel_id")
# Users section.

log.info(f"Special users: {', '.join([str(a) for a in SPECIAL_USERS_IDS])}")
DEV_ID = config.get("Users", "developer_id")
ADMIN_ID = config.get("Users", "admin_id")

####################
#       bans       #
####################


def get_bans():
    with open("./data/bans.csv", newline='') as file:
        names = []
        read = csv.reader(file, delimiter='\n', quotechar='|')
        for row in read:
            names.append(row)
        return names


def get_user_ban(name):
    bans = get_bans()
    for each in bans:
        if each == name:
            return True
    return False


# I highly doubt this is remotely close to the correct way of doing something like this, but it is what it is, I guess.
def rm_ban(user):
    with open("./data/bans.csv", newline='') as read_file:
        read = csv.reader(read_file, delimiter='\n', quotechar='|')
        file = []
        for each in read:
            if each != user:
                file.append(each)
    with open("./data/bans.csv", 'w+', newline='') as write_file:
        write = csv.writer(write_file, delimiter='\n', quotechar='|')
        for each in file:
            write.writerow(each)


def add_ban(user):
    if get_user_ban(user):
        return False

    with open("./bans/bans.csv", "a", newline='') as write_file:
        write = csv.writer(write_file, delimiter='\n', quotechar='|')
        write.writerow(user)
